/**
 * Klaviyo-Webflow Integration (Static version)
 * @version 1.0.0
 * @license MIT
 */
(function(){
  // Simple implementation for testing
  window.initKlaviyoWebflow = function(config) {
    console.log("Klaviyo-Webflow integration initialized with:", config);
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initForms);
    } else {
      initForms();
    }
    
    function initForms() {
      // Find all Klaviyo forms
      const forms = document.querySelectorAll('[data-klaviyo-form], [data-klaviyo-account-id], [data-klaviyo-list-id]');
      console.log(`Found ${forms.length} Klaviyo forms`);
      
      // Set up each form
      forms.forEach(form => {
        // Skip if already initialized
        if (form.hasAttribute('data-klaviyo-initialized')) return;
        
        // Add submit handler
        form.addEventListener('submit', handleSubmit);
        
        // Mark as initialized
        form.setAttribute('data-klaviyo-initialized', 'true');
        console.log(`Initialized form: ${form.id || 'unnamed'}`);
      });
    }
    
    function handleSubmit(event) {
      const form = event.target;
      event.preventDefault();
      console.log("Form submission captured:", form.id);
      
      // Get the form data
      const formData = new FormData(form);
      const data = {};
      for (const [key, value] of formData.entries()) {
        data[key] = value;
      }
      
      console.log("Form data:", data);
      
      // Show success message
      const successEl = form.querySelector('.success-message') || form.querySelector('.w-form-done');
      const errorEl = form.querySelector('.error-message') || form.querySelector('.w-form-fail');
      
      if (successEl) {
        // Hide form fields
        Array.from(form.querySelectorAll('input, button')).forEach(el => el.style.display = 'none');
        successEl.style.display = 'block';
        if (errorEl) errorEl.style.display = 'none';
      }
    }
  };
  
  // Debug helper
  window.klaviyoWebflowDebug = function() {
    return {
      version: '1.0.0',
      apiRevision: '2025-04-15',
      formsFound: document.querySelectorAll('[data-klaviyo-form], [data-klaviyo-account-id], [data-klaviyo-list-id]').length,
      forms: Array.from(document.querySelectorAll('[data-klaviyo-form], [data-klaviyo-account-id], [data-klaviyo-list-id]')).map(form => ({
        id: form.id,
        classes: form.className,
        hasApiKey: !!form.getAttribute('data-klaviyo-account-id'),
        hasListId: !!form.getAttribute('data-klaviyo-list-id'),
        initialized: form.hasAttribute('data-klaviyo-initialized')
      }))
    };
  };
})(); 